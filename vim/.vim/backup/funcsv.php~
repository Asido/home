<?php

function getAudiolength($tour_id)
{
$r = "SELECT audio_length FROM tour_details WHERE tour_id='$tour_id'";
$w = mysql_query($r);
	if(mysql_num_rows($w)>0)
	{
		$onerow=mysql_fetch_array($w);
		$audio = $onerow['audio_length'];
		if($audio=='lessthan30')
		{
			return "Less than 30 Minutes";
		}
		else if($audio=='30-60')
		{
			return "30-60 Minutes";
		}
		else if($audio=='morethan60')
		{
			return "More than 60 Minutes";
		}
		
		
	}
	
}
function getVideolength($tour_id)
{
$r = "SELECT lw_length FROM tour_details WHERE tour_id='$tour_id'";
$w = mysql_query($r);
	if(mysql_num_rows($w)>0)
	{
		$onerow=mysql_fetch_array($w);
		$audio = $onerow['lw_length'];
		if($audio=='lessthan60')
		{
			return "Less than 60 Minutes";
		}
		else if($audio=='60-120')
		{
			return "60-120 Minutes";
		}
		else if($audio=='morethan120')
		{
			return "More than 120 Minutes";
		}
		
		
	}
	
}
function connect()
{
	//echo $_SERVER['SERVER_NAME']; 
	if($_SERVER['SERVER_NAME']=="localhost")
	{
			$con = mysql_connect("localhost","root","");
			mysql_select_db("webeteer_yt",$con);
	}
	if($_SERVER['SERVER_NAME']=="192.168.137.1")
	{
			$con = mysql_connect("localhost","root","");
			mysql_select_db("webeteer_yt",$con);
	}

	if($_SERVER['SERVER_NAME']=="webeteerprojects.com")
	{
		$con = mysql_connect("localhost","webeteer_jithin","caution123");
		mysql_select_db("webeteer_yt",$con);
	}
	if($_SERVER['SERVER_NAME']=="www.webeteerprojects.com")
	{
		$con = mysql_connect("localhost","webeteer_jithin","caution123");
		mysql_select_db("webeteer_yt",$con);
	}
	if(substr($_SERVER['SERVER_NAME'],-12) =="youtours.com")
	{
		$con = mysql_connect('localhost','youtours_yt','Joes88') or die(mysql_error());
		mysql_select_db('youtours_yt',$con) or die(mysql_error());
	}
	return $con;
	
}


connect();




function cookieLogin($user,$pass)
{
	
	$q = "SELECT * FROM users where email='$user' AND password ='$pass'";
	if(mysql_num_rows($p=mysql_query($q))>0)
	{
		$onerow= mysql_fetch_array($p);
		session_start();
		$_SESSION['email']=$user;
		$_SESSION['user_id'] =$onerow['uid'];
		return true;
	}
	return false;
}
function RemoveNull() //Removes all null entries generated by uploadtours.php
{
	error_reporting(0);
	
	session_start();
	$user_id = $_SESSION['user_id'];
	connect();
	$q = "DELETE FROM tour_details WHERE title='None' AND user_id='$user_id'";
	 $r = mysql_query($q);
	return; 
	
}
function post($val)
{
	if(isset($_POST[$val]))
	{
		return true;	
	}
	else
	{
		return false;
	}
	
}
function getPost($val)
{
	if(isset($_POST[$val]))
	{
		return $_POST[$val];	
	}
	else
	{
		return "";
	}
	
}
if(isset($_POST))
{
	if(isset($_POST['src']))
	{
		savemap($_POST['src']);
	}
}
function savemap($src)
{
	
	echo $src;
	exit;
	
}
function xmlparse($str)
{

$xmlStr = $str;
$xmlObj = simplexml_load_string($xmlStr);
$arrXml = objectsIntoArray($xmlObj);
print_r($arrXml);
}
function objectsIntoArray($arrObjData, $arrSkipIndices = array())
{
    $arrData = array();
    
    // if input is object, convert into array
    if (is_object($arrObjData)) {
        $arrObjData = get_object_vars($arrObjData);
    }
    
    if (is_array($arrObjData)) {
        foreach ($arrObjData as $index => $value) {
            if (is_object($value) || is_array($value)) {
                $value = objectsIntoArray($value, $arrSkipIndices); // recursive call
            }
            if (in_array($index, $arrSkipIndices)) {
                continue;
            }
            $arrData[$index] = $value;
        }
    }
    return $arrData;
}
function getSingleValue($query,$field,$debug=false)
{
	
	require_once("php/database.php");
	$r = mysql_query($query);
	if(mysql_num_rows($r)>0)
	{
		$onerow = mysql_fetch_array($r);
		return $onerow[$field];
		
	}
	else
	{
		return 0;
	}
	
	
}
function query($query)
{
	$k=0;
	$r = mysql_query($query);
	return $r;
}

function getReview($user_id,$tour_id)
{
	$q = "SELECT review FROM reviews WHERE uid='$user_id' AND tour_id='".$tour_id."'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['review'];
			
		}
	}
	
}
function getReviewNumber($tour_id)
{
	$q = "SELECT review FROM reviews WHERE uid='$user_id' AND tour_id='".$tour_id."'";
	$r = mysql_query($q);
	return mysql_num_rows($r);
	
	
}
function checkLogin()
{

	if(!session_is_registered('email'))
	{
		header("location:login.php");	
	}
}
function getPicpath($album_id,$single=false)
{
	$q = "SELECT pic_path FROM album WHERE album_id='$album_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		$i=0;
		while($onerow=mysql_fetch_array($r))
		{
			$result[$i]=$onerow['pic_path'];
			$i++;
		}
	
		if($single==true)
		{
			return $result[0];
		}
		else
		{
			return $r;
		}
	}
	else
		return "images/no_image.png";
}
function getTourDetails($user_id=false,$tour_id=false)
{
	if($tour_id!=false && $user_id!=false)
	{
		$q = "SELECT * FROM tour_details WHERE user_id='$user_id' AND tour_id='$tour_id'";
	}
	else if($user_id!=false)
	{
		$q = "SELECT * FROM tour_details where user_id ='$user_id'";
		
	}
	else if($tour_id!=false)
	{
		$q = "SELECT * FROM tour_details where tour_id='$tour_id'";
	}
	//echo $q;
	//exit;
	$r = mysql_query($q);
	
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			$result[$onerow['tour_id']]=$onerow;
			
		}
		
		return $result;
	}
	else
	{
		return false;
	}
	
	
	
	
}
function getTourDetails1($user_id=false,$tour_id=false)
{
	if($tour_id!=false && $user_id!=false)
	{
		$q = "SELECT * FROM tour_details WHERE user_id='$user_id' AND tour_id='$tour_id'";
	}
	else if($user_id!=false)
	{
		$q = "SELECT * FROM tour_details where user_id ='$user_id'";
		
	}
	else if($tour_id!=false)
	{
		$q = "SELECT * FROM tour_details where tour_id='$tour_id'";
	}
	//echo $q;
	//exit;
	$r = mysql_query($q);
	
	if(mysql_num_rows($r)>0)
	{
		return $r;
	}
	else
	{
		return false;
	}
	
	
	
	
}
function getTourDetails2($tour_id)
{


		$q = "SELECT * FROM tour_details where tour_id='$tour_id'";
	
	//echo $q;
	//exit;
	$r = mysql_query($q);
	
	if(mysql_num_rows($r)>0)
	{
		return $r;
	}
	else
	{
		return false;
	}
}
function getTourDetails3($user_id)
{


		$q = "SELECT * FROM tour_details where user_id='$user_id'";
	
	//echo $q;
	//exit;
	$r = mysql_query($q);
	
	if(mysql_num_rows($r)>0)
	{
		return $r;
	}
	else
	{
		return false;
	}
}
function getFullname($user_id)
{
	$q = "SELECT fullname FROM users WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['fullname'];
		}
	}
}
function getEmail($user_id)
{
	$q = "SELECT email FROM users WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['email'];
		}
	}
}

function getCity($city_id)
{
	//echo 'SELECT city_name FROM city where city_id='.$city_id;
	
	$r=mysql_query("SELECT city_name FROM city where city_id=".$city_id);
		if(mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return  $onerow['city_name'];
	}
	
}
function getCityID($city_name)
{
	//echo 'SELECT city_Id FROM city where city_name='.$city_name;
	
	$r=mysql_query("SELECT city_id FROM city where city_name='".$city_name."'");
		if(mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return $onerow['city_id'];
	}
	
}
function getLanguage($language_id)
{
	$r=	mysql_query("SELECT language FROM language where language_id=".$language_id);

	if(@mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return  $onerow['language'];
	}
	

	
}
function getCategory($category_id)
{
	$r=	mysql_query("SELECT category FROM category where category_id=".$category_id);
	
	if(@mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return  $onerow['category'];
	}
	

	
}
function getCategoryID($category_name)
{
	$r=	mysql_query("SELECT category_id FROM category where category=".$category_name);
	
	if(mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return  $onerow['category'];
	}
	

	
}
function truncate($str)
{
	if(strlen($str)>250)
	{
		$str = substr($str,0,245);
		$str = $str."...";
		return $str;
	}
	else
	{
		return $str;
	}
}
function getRating($tour_id)
{
	$q = "SELECT rating FROM reviews WHERE tour_id='$tour_id'";
	$r = mysql_query($q);
	$i=0;
	$rating=0;
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			$rating +=$onerow['rating'];
			$i++;
		}
		return $rating=round($rating/$i);
	}
	return 0;
	
}
//connect();
//echo printRating(getRating(14));
function printRating($rate)
{
	$ratestring="";
	for($rat=0;$rat<5;$rat++)
		{
			
			if($rat<$rate)
			{
				$ratestring.="<div class='si-ratedstar'></div>";
			}
			else
			{
				$ratestring.="<div class='si-unratedstar'></div>";
			}
		}
		 return $ratestring;
}
function getCountryname($user_id)
{
	$r=	mysql_query("SELECT country_name FROM user_details,country where user_details.country_id=country.country_id and user_details.uid=".$user_id);

	if(mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return  $onerow['country_name'];
	}
	

	
}
function getZip($user_id)
{
	$q = "SELECT zip_code FROM user_details WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['zip_code'];
		}
	}
}
function getStreet($user_id)
{
	$q = "SELECT street FROM user_details WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['street'];
		}
	}
}
function getBio($user_id)
{
	$q = "SELECT bio FROM user_details WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['bio'];
		}
	}
}
function getcountryid($user_id)
{
	$q = "SELECT country_id FROM user_details WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['country_id'];
		}
	}
}

function getcountryid1($user_id)
{
	$q = "SELECT country_id FROM user_details WHERE uid='$user_id'";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		while($onerow=mysql_fetch_array($r))
		{
			return $onerow['country_id'];
		}
	}
}
function getState($user_id)
{
	$r=	mysql_query("SELECT state_name FROM user_details,state where user_details.state_id=state.state_id and user_details.uid=".$user_id);

	if(mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		return  $onerow['state_name'];
	}
	

	
}
function getProfilePic($user_id)
{
	connect();
	$q = "SELECT prof_pic FROM users WHERE uid=$user_id";
	$r = mysql_query($q);
	if(mysql_num_rows($r)>0)
	{
		$onerow=mysql_fetch_array($r);
		
		$pic = $onerow['prof_pic'];
		if(substr($pic,0,6)=="http:/")
		{
			return $pic;	
		}
		else
		{
			return "uploads/$pic";	
		}
	}

}
//echo getProfilePic(14);
function photoResize($imagefile,$width)
{

   header('Content-Type: image/jpeg');
   include('SimpleImage.php');
   $image = new SimpleImage();
   $image->load($imagefile);
   $image->resizeToWidth($width);
   $image->output();


}
function getExtension($path)
{
    return substr($path, -3);
}
//generateThumb("p161pkva9c1nm8181u5oqt0e5pf3.wav");

function generateThumb($videopath,$width,$height)
{
    try{
         $ext = getExtension($videopath);
        if($ext=='wav' || $ext=='mp3' || $ext=='ogg' || $ext=='mid'){
            
            return $thumb = 'images/rij.png';
        }
        else if($ext=='avi' || $ext=='mpeg' || $ext=='mpg' || $ext=='dat' || $ext=='mov' || $ext=='wmv' || $ext=='mkv'){
            $ext;
            if(extension_loaded('ffmpeg') && extension_loaded('gd') && function_exists("imagecreatetruecolor")){
            
              $frame = 70;
            
              $mov = new ffmpeg_movie(dirname(__FILE__) ."/uploads/". $videopath);
              $img = sprintf("uploads/$videopath.png");
              $ff_frame = $mov->getFrame($frame);
              if ($ff_frame) {
                  $ff_frame->resize($width, $height);
                  $gd_image = $ff_frame->toGDImage();
                  if ($gd_image) {
                      imagepng($gd_image, $img);
                      imagedestroy($gd_image);
                    return "uploads/$videopath.png";
                  }
              }
            
            }
            else{
                $thumb = "images/rij.png";
                return $thumb ;
            }
        }

    }
    catch(Exception $e)
    {
        return $thumb = "images/rij.png";
        
    }
}

//ba44a45e31e5215c553e8267bf78794d41b63abe

?>
