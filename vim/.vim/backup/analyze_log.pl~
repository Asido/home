#!/usr/bin/perl -w

use strict;

my $file = 'log';
my %traffic = ();
my $bytes;
my $path;
open(my $log, '<', $file) || die("Could not open '$file': $!");

while(my $log_line = <$log>) {
	$bytes = $log_line;
	# Extracts the two numbers from a line - error code and bytes.
	$bytes =~ s/.*"GET .*?" (.*?) ".*/$1/;
	# If error code = 200, the page request was successful.
	if($bytes =~ /^200/) {
		$bytes =~ s/.*?([0-9]*$)/$1/;
	}
	# If the page reuqest was NOT successful, skip this request.
	else {
		next;
	}

	$path = $log_line;
	$path =~ s/.*("GET .*?").*/$1/;
	$path =~ s/".*?\s(.*?)\s.*/$1/;

	chomp($path);
	chomp($bytes);

	unless(exists($traffic{$path})) {
		$traffic{$path} = $bytes;
	}
	else {
		$traffic{$path} += $bytes;
	}
}

while(my ($key, $value) = each(%traffic)) {
	print "Path: $key\n";
	print "Bytes used: $value\n\n";
}
