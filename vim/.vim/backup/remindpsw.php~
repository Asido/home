<?php

	function remind_password($email)
	{
		$password = $this->generate_password();
		$changed = $db->query("UPDATE users
			 	  SET password = '".md5($password)."'
				  WHERE email = '".$email."'";
		if ($changed)
			send_password_reminder_mail($email, $password);	
		return $changed;
	}

	function generate_password($length = 8)
	{
		$password = "";
		$possible = "2346789bcdfghjkmnpqrtvwxyzBCDFGHJKLMNPQRTVWXYZ";
		$maxlength = strlen($possible);
		if ($length > $maxlength)
			$length = $maxlength;
		$i = 0;
		while ($i < $length) {
			$char = substr($possible, mt_rand(0, $maxlength-1), 1);
			if (!strstr($password, $char)) {
				$password .= $char;
				$i++;
			}
		}
		return $password;
	}

	function send_password_reminder_mail($to, $password)
	{
		$message = generate_password_reminder_message($to, $password);
		$transport = Swift_SmtpTransport::newInstance();
		$mailer = Swift_Mailer::newInstance($transport);
		$msg = Swift_Message::newInstance(SMESSAGES::PASSWORD_REMINDER_MAIL_TITLE)
			->setFrom(array('contractorbridge@contractorbridge.com' => SMESSAGES::MAIL_FROM))
			->setTo(array($to => ""))
			->setBody($message);//'Here is the message itself');
		$result = $mailer->send($msg);
	}

	function generate_password_reminder_message($email, $password)
	{
		return "Here is a new generated password for you.
	You can now login using:
	User name: ".$email."
	Password: ".$password;
	}

?>
