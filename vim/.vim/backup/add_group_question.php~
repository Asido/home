<?php
require_once('database.php');

@ session_start();

$db = database::get_instance();
$group = $_POST['category'];

if (!isset($_POST['cms-q']) || $_POST['cms-q'] === "") {
	echo '{ "ret": "Question field is not filled." }';
	exit;
}

if (isset($_POST['cms-a8']) && $_POST['cms-a8'] !== "")
	$answer_count = 8;
else if (isset($_POST['cms-a7']) && $_POST['cms-a7'] !== "")
	$answer_count = 7;
else if (isset($_POST['cms-a6']) && $_POST['cms-a6'] !== "")
	$answer_count = 6;
else if (isset($_POST['cms-a5']) && $_POST['cms-a5'] !== "")
	$answer_count = 5;
else if (isset($_POST['cms-a4']) && $_POST['cms-a4'] !== "")
	$answer_count = 4;
else if (isset($_POST['cms-a3']) && $_POST['cms-a3'] !== "")
	$answer_count = 3;
else if (isset($_POST['cms-a2']) && $_POST['cms-a2'] !== "")
	$answer_count = 2;
else if (isset($_POST['cms-a1']) && $_POST['cms-a1'] !== "") {
	echo '{ "ret": "Error: A question cannot have 1 answer" }';
	exit;
} else // 1 == input question
	$answer_count = 1;

foreach ($_GET as $key => $value)
	$db->format_string($value);

$query = "SELECT * FROM `group_questions` WHERE `question`='".$_POST['cms-q']."' AND `group_id`='".$group."'";
$sql = $db->query($query);
if (mysql_num_rows($sql) != 0) {
	echo '{ "ret": "Specified question already exist in this group." }';
	exit;
}

$query = "INSERT INTO `group_questions`
	(`group_id`,`answer_count`,`question`,`answer1`,`answer2`,`answer3`,`answer4`,`answer5`,`answer6`,`answer7`,`answer8`,`created_by`)
	VALUES
	('".$group."',".$answer_count.",'".$_POST['cms-q']."','".$_POST['cms-a1']."','".$_POST['cms-a2']."','".$_POST['cms-a3']."',
	'".$_POST['cms-a4']."','".$_POST['cms-a5']."','".$_POST['cms-a6']."','".$_POST['cms-a7']."','".$_POST['cms-a8']."',
	'".$_SESSION['username']."')";
$db->query($query);

if (mysql_error())
	echo '{ "ret": "'.mysql_error().'" }';
else
	echo '{ "ret": "The questions has been successfully added." }';
?>
