#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/stat.h>

int main(int argc, char *argv[])
{
	if (argc < 2 || strcmp(argv[1], "--help") == 0) {
		printf("Usage: %s file\n", argv[0]);
		exit(EXIT_SUCCESS);
	}

	int i;
	struct stat *file_info = malloc(sizeof(struct stat));

	for (i = 1; i < argc; ++i) {
		if (access(argv[i], F_OK) == -1) {
			printf("File not found: %s\n", argv[i]);
			exit(EXIT_SUCCESS);
		}
	}

	for (i = 1; i < argc; ++i) {
		stat(argv[i], file_info);
		if (chmod(argv[i], file_info->st_mode | S_IRUSR | S_IRGRP | S_IROTH) == -1)
			printf("ERROR: chmod1");
		if (S_ISDIR(file_info->st_mode) || (file_info->st_mode & S_IXUSR) != 0 ||
			(file_info->st_mode & S_IXGRP) != 0 || (file_info->st_mode & S_IXOTH) != 0) {
			if (chmod(argv[i], file_info->st_mode | S_IXUSR | S_IXGRP | S_IXOTH) == -1)
				printf("ERROR: chmod2");
			
		}
	}

	free(file_info);
	exit(EXIT_SUCCESS);
}
