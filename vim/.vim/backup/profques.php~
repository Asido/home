<?php

include_once('php/auth.php');

$logged = false;

if ($auth->logged_in() || $auth->cookie_login()) {
	$logged = true;
}

if (!$logged && isset($_POST['username']) && isset($_POST['password'])) {
	$success = $auth->login($_POST['username'], $_POST['password'], isset($_POST['login-remember']));
	$logged = $success;
}

if (isset($_GET['join'])) {
	$auth->join_group($_GET['category'], $_SESSION['username']);
	header("Location: profques.php?category=".$_GET['category']);
	exit;
}

?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<script type="text/javascript">
/* ARRAY INDEX OF SUPPORT FOR IE */
if(!Array.indexOf) {
	    Array.prototype.indexOf = function(obj){
	        for(var i=0; i < this.length; i++){
	            if(this[i]==obj){
	                return i;
	            }
	        }
	        return -1;
	    }
}
</script>
<link rel="stylesheet" href="css/styles.css" />
<link rel="stylesheet" href="css/profques.css" />

<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="js/jquery.blockUI.js"></script>

<script type="text/javascript" src="js/login.js"></script>

<script type="text/javascript" src="js/submit.js"></script>

<script type="text/javascript" src="js/validation.js"></script>

<script type="text/javascript" src="js/notif.js"></script>

<script type="text/javascript" src="js/url_param.js"></script>

<script type="text/javascript" src="js/popup.js"></script>

<?php if ($logged) { ?>
<script type="text/javascript" src="js/user_profques.js"></script>
<?php } else { ?>
<script type="text/javascript" src="js/guest_profques.js"></script>
<?php } ?>

<script>
$(document).ready(function() {
	$.growlUI("Answer questions with your keyboard",   "1 - answer 1<br/>\n\
														2 - answer 2<br/>\n\
														3 - answer 3<br/>\n\
														4 - answer 4<br/>\n\
														5 - answer 5<br/>\n\
														6 - answer 6<br/>\n\
														7 - answer 7<br/>\n\
														8 - answer 8<br/>\n\
														&#8594 - skip",
	5000, function() {});
});

$(document).keydown(function(e)
{	
	switch(e.keyCode)
	{
		// user presses the "1" key		
		case 49:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=1]").attr("checked","checked");						
						$('#pressed').val(1);
						setAnswer();
					}
					break;	

		// user presses the "2" key
		case 50:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=2]").attr("checked","checked");
						$('#pressed').val(1);
						setAnswer();
					}
					break;

		// user presses the "3" key
		case 51:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=3]").attr("checked","checked");
						$('#pressed').val(1);
						setAnswer();
					}
					break;

		// user presses the "4" key
		case 52:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=4]").attr("checked","checked");
						$('#pressed').val(1);		
						setAnswer();
					}
					break;

		case 53:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=5]").attr("checked","checked");
						$('#pressed').val(1);		
						setAnswer();
					}
					break;

		case 54:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=6]").attr("checked","checked");
						$('#pressed').val(1);		
						setAnswer();
					}
					break;

		case 55:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=7]").attr("checked","checked");
						$('#pressed').val(1);		
						setAnswer();
					}
					break;

		case 56:	if($('#pressed').val() == 0){
						$("[name=qanswer]").filter("[value=8]").attr("checked","checked");
						$('#pressed').val(1);		
						setAnswer();
					}
					break;

		// user presses the "->" key
		case 39:	skip();
					break;
	}
});


</script>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>likemelikeU</title>

<style>


</style>
</head>



<body>



<?php

	include_once('php/html.php');



	if ($logged)

		HTML::show_logged_header();

	else

		HTML::show_header("profques.php");

?>

<input type="hidden" id="question_id" />	<!-- holds the current question's id -->
<input type="hidden" id="prev_question_id" />
<input type="hidden" value="0" id="pressed" />
<div id="container-prof">

	<div id="prof-wrap">

    	<div id="slideshow">

          <div id="slidesContainer">            
			<div id="slide-background"></div>

            <div id="slideInner">
            </div>
          </div>

            <?php
     		require_once('php/group_users.php');
			
			if (isset($_GET['category']) && !user::is_default_category($_GET['category']) && !user::belong_to_group($_SESSION['username'], $_GET['category']) && user::group_exist($_GET['category']))
				echo '<a href="profques.php?category='.$_GET['category'].'&join">Click here to join group: '.user::groupid_to_name($_GET['category']).'</a>';
            ?>
        </div>

        

    	

    	<div id="prof-buttons"> 

        	<div id="prof-left">

                <span class="prof-righttxt"><a href=""> View What people answered <br/>last Question </a></span>

            </div>

            <div id="prof-right">

                <span class="prof-righttxt"><a href="" style="margin-top: 10px;"> You have answered <span id="answered_count">1</span>/<span id="questions_count"></span></a></span>

            </div>

        </div>

    </div><!--prof-wrap-->
	
</div><!--container-prof-->

<?
	if(isset($_GET['Qid'])){
		print "<input type=\"hidden\" name=\"Qid\" id=\"Qid\" value=".mysql_real_escape_string($_GET['Qid'])." />";
	}else{
		print "<input type=\"hidden\" name=\"Qid\" id=\"Qid\" value=\"0\" />";
	}
?>

<!-- THIS POPUP IS FOR SHOWING THE STATISTICS OF A PARTICULAR QUESTION -->
<div id="statistic-popup">
	<div id="quest-stat-wrapper">
		<span class="statistic-x"></span>
		<div id="quest-stat-content">
			<h4><div class="statistic-question"></div></h4>
			<div class="statistic-answer-container">
				<div class="statistic-answer-nr">1</div>
				<span id="answer-string-1" class="statistic-answer"></span>
				<span id="answer-percent-1" class="statistic-percent"></span>
			</div><!-- statistic-answer-container -->
			<div class="statistic-answer-container">
				<div class="statistic-answer-nr">2</div>
				<span id="answer-string-2" class="statistic-answer"></span>
				<span id="answer-percent-2" class="statistic-percent"></span>
			</div><!-- statistic-answer-container -->
			<div class="statistic-answer-container">
				<div class="statistic-answer-nr">3</div>
				<span id="answer-string-3" class="statistic-answer"></span>
				<span id="answer-percent-3" class="statistic-percent"></span>
			</div><!-- statistic-answer-container -->
			<div class="statistic-answer-container">
				<div class="statistic-answer-nr">4</div>
				<span id="answer-string-4" class="statistic-answer"></span>
				<span id="answer-percent-4" class="statistic-percent"></span>
			</div><!-- statistic-answer-container -->

			<!-- <span id="statistic-popup-submit"></span> -->

			<!-- GRAPH -->
			<div id="statistic-graph-wrapper">
				<!-- graph % -->
				<span id="graph-100" class="graph-percent">100</span>
				<span id="graph-50" class="graph-percent">50</span>
				<span id="graph-0" class="graph-percent">0</span>
				<!-- graph frame -->
				<table class="graph-table">
					<tr>
						<td class="graph-upper graph-row"></td>
					</tr>
						<td class="graph-lower graph-row"></td>
					<tr>
					</tr>
				</table>
				<!-- graph bars -->
				<div id="graph-bar-1" class="graph-bar"></div>
				<div id="graph-bar-2" class="graph-bar"></div>
				<div id="graph-bar-3" class="graph-bar"></div>
				<div id="graph-bar-4" class="graph-bar"></div>
				<!-- graph answer number -->
				<span id="graph-answer-1" class="graph-answer">1</span>
				<span id="graph-answer-2" class="graph-answer">2</span>
				<span id="graph-answer-3" class="graph-answer">3</span>
				<span id="graph-answer-4" class="graph-answer">4</span>
			</div>
			<!-- /GRAPH -->
		</div><!-- quest-stat-content -->
	</div><!-- quest-stat-wrapper -->
</div><!-- statistic-popup -->


<?php

	include_once('php/html.php');

	HTML::show_background();

	HTML::show_footer();

?>



</body>

</html>

