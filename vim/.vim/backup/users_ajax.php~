<?php
	require_once( 'database.php' );

	$cmd 	= $_POST['cmd'];
	if ( !isset($cmd) ) exit;
	$category = $_POST['category'];
	if ($category != "top100" && $category != "top10" && $category != "profile" && $category != "skipped")
		require_once('group_users.php');
	else
		require_once('users.php');

	// if ( !isset($category) ) exit;

	switch ( $cmd )
	{
		case 'get' :
			if($_POST['id'] != 0)
				$q = user::get_question_by_id( $_POST['exceptions'], $category, $_POST['id'] );
			else
				$q = user::get_question( $_POST['exceptions'], $category );

			echo '{ ';
			if ($q)
			{
				echo 
					'
						"question_id"		: '	.$q['id']. ',
						"answer_count"		: '	.$q['answer_count']. ',
						"question"			: "'.$q['question'].'",
						"answer1"			: "'.$q['answer1'].'",
						"answer2"			: "'.$q['answer2'].'",
						"answer3"			: "'.$q['answer3'].'",
						"answer4"			: "'.$q['answer4'].'",
						"answer5"			: "'.$q['answer5'].'",
						"answer6"			: "'.$q['answer6'].'",
						"answer7"			: "'.$q['answer7'].'",
						"answer8"			: "'.$q['answer8'].'",
						"reset_exceptions"	: '	.$q['reset_exceptions']. ',
					';
			}
			else 
				echo '"question"	: null,';

			echo '	"answered"		: ' . count ( user::get_answers($category) ) . ', ' . 			// getting the number of answered questions
				 '
				 	"total"			: ' . user::questions_num($category);					// getting total questions
			echo ' }';

			exit;

		case 'set':
			$q = $_POST['question_id'];
			$a = $_POST['answer_num'];
			if ( ! (
						isset ($q) &&
						isset ($a) ) ) exit;
			user::set_answer( $category, $q, $a );			
			exit;
	}

?>

