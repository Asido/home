<?xml version="1.0"?>
<project name="junit_with_ant" default="test-basic" basedir=".">

	<property name="build.dir" location="${basedir}/build" />
	<property name="test.suite" value="d1.core.test.SimpleTest" />
	<property name="test.dir" location="${build.dir}/test" />
	<property name="test.classes.dir" location="${test.dir}/classes" />
	<property name="test.data.dir" location="${test.dir}/data" />
	<property name="test.reports.dir" location="${test.dir}/reports" />

	<path id="compile.classpath">
		<fileset dir="lib">
			<include name="*.jar" />
		</fileset>
	</path>

	<path id="test.compile.classpath">
		<path refid="compile.classpath" />
		<pathelement location="${build.classes.dir}" />
		<pathelement location="${build.dir}/classes" />
	</path>

	<path id="test.classpath">
		<path refid="test.compile.classpath" />
		<pathelement location="${test.classes.dir}" />
	</path>

	<target name="test-init">
		<mkdir dir="${test.classes.dir}" />
		<delete dir="${test.data.dir}" />
		<delete dir="${test.reports.dir}" />
		<mkdir dir="${test.data.dir}" />
		<mkdir dir="${test.reports.dir}" />
	</target>

	<target name="app-init">
		<delete dir="${build.dir}/classes" />
		<mkdir dir="${build.dir}/classes" />
	</target>

	<target name="compile" depends="app-init">
		<javac srcdir="src"
				destdir="${build.dir}/classes"
				includeantruntime="false" />
	</target>

	<target name="test-compile" depends="compile, test-init">
		<javac destdir="${test.classes.dir}"
				debug="true"
				includeAntRuntime="true"
				classpath="${basedir}/src"
				srcdir="test">
			<classpath refid="test.compile.classpath" />
		</javac>
	</target>

				<echo message="**/test/*Test.class" />
	<echo message="test.classes.dir = ${test.classes.dir}" />
	<echo message="test.data.dir = ${test.data.dir}" />
	<target name="test-basic" depends="test-compile">
		<junit printsummary="false" haltonfailure="true">
			<classpath refid="test.classpath" />
			<formatter type="brief" usefile="false" />
			<!--<test name="${test.suite}" />-->
			<batchtest todir="${test.data.dir}">
				<fileset dir="${test.classes.dir}"
					includes="**/test/*Test.class" />
			</batchtest>
		</junit>
	</target>

</project>
