<?php

require_once('php/auth.php');

$logged = $auth->logged_in();

if (!$logged) {
	if (!$auth->cookie_login()) {
		header('Location: login.php');
		exit;
	}
}

$points = $auth->get_points($_SESSION['username']);

if ($points >= 50)
	$questions_created = $auth->questions_created($_SESSION['username']);

?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>LikemelikeU</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/styles.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery-1.4.2.js"></script>
<script type="text/javascript" src="js/search.js"></script>
<script type="text/javascript">
	$(document).ready ( function (){
		$("#answer-now-profile").click(function() {
			window.location.href = "profques.php?category=profile";
		});
		$("#answer-now-top10").click(function() {
			window.location.href = "profques.php?category=top10";
		});
		$("#answer-now-top100").click(function() {
			window.location.href = "profques.php?category=top100";
		});
		$("#answer-now-skipped").click(function() {
			window.location.href = "profques.php?category=skipped";
		});
	});
	
	
</script>
</head>

<body>

<?php
	include_once('php/html.php');

	if ( !database )
		require ( 'database.php' );

	HTML::show_logged_header();
?>
<script>
	$(".dashboard-btn").addClass("bh-selected");
</script>
<?php
	$db = database::get_instance();

	//PROFILE QUESTIONS AND ANSWERS
	$sql = $db->query("SELECT COUNT(id) AS number FROM profile_questions");
	$rez = mysql_fetch_array($sql);
	$profile_q_no = $rez['number'];

	$sql = $db->query("SELECT COUNT(question_id) AS number FROM profile_answers WHERE username='".$_SESSION['username']."'");
	$rez = mysql_fetch_array($sql);
	$profile_a_no = $rez['number'];

	$profile_perc = $profile_a_no/$profile_q_no*100;
	$profile_perc = number_format( $profile_perc, 2 );

	//TOP100 QUESTIONS AND ANSWERS
	$sql = $db->query("SELECT COUNT(id) AS number FROM top100_questions");
	$rez = mysql_fetch_array($sql);
	$top100_q_no = $rez['number'];

	$sql = $db->query("SELECT COUNT(question_id) AS number FROM top100_answers WHERE username='".$_SESSION['username']."'");
	$rez = mysql_fetch_array($sql);
	$top100_a_no = $rez['number'];

	$top100_perc = $top100_a_no/$top100_q_no*100;
	$top100_perc = number_format( $top100_perc, 2 );

	//TOP10 QUESTIONS AND ANSWERS
	$sql = $db->query("SELECT COUNT(id) AS number FROM top10_questions");
	$rez = mysql_fetch_array($sql);
	$top10_q_no = $rez['number'];

	$sql = $db->query("SELECT COUNT(question_id) AS number FROM top10_answers WHERE username='".$_SESSION['username']."'");
	$rez = mysql_fetch_array($sql);
	$top10_a_no = $rez['number'];

	$top10_perc = $top10_a_no/$top10_q_no*100;
	$top10_perc = number_format( $top10_perc, 2 );

	$total_q = $politics_q_no + $profile_q_no + $sports_q_no + $top100_q_no + $top10_q_no + $music_q_no;
	$total_a = $politics_a_no + $profile_a_no + $sports_a_no + $top100_a_no + $top10_a_no + $music_a_no;

	$total_perc = max(min($total_a/$total_q*100, 100), 0);
	$total_perc = number_format( $total_perc, 2 );
?>

<div id="container-admin">
    <div class="si-main">
        <div class="si-submain">
            <table width="800" border="0" class="si-table1">
              <tr>
                <td width="250"><p style="margin-top:22px; margin-left:88px;">Question About :</p></td>
                <td width="400"><input type="text" name="search_input" id="search_input" class="si-textbx" style="margin-top:10px;"/></td>
                <td width="110">&nbsp;<div class="si-searchbtn"><p style="margin-top:8px; margin-left:15px; color:#FFF;" id="search_btn">SEARCH</p></div></td>
              </tr>
            </table>
			<div class="si-mainbelow" id="si-mainbelow">  
				<div id="questions" style="position:relative; padding: 5px 0 0 0;">
					<input type="hidden" id="h_page_nr" name="h_page_nr" value="1">
				</div>
				<div class="si-page"><span class="si-arrows" id="prev"> &laquo; </span>&nbsp;&nbsp;<span class="si-arrows" id="next"> &raquo; </span></div>
			</div>    
    
        </div>
        
        <div class="mid-container">
        
        	<div class="mid-option">
            	<div id="icon-profile" class="mid-icon"></div>
                <div class="mid-title">Profile Questions</div>
                <div id="answer-now-profile" class="mid-button">Complete Answers</div>
				<div class="option-percent"><?php echo $profile_perc."%"; ?> Complete</div>
                <div class="option-loadwrap">
					<div class="option-loading" style="width: <?php echo $profile_perc; ?>%; <?php if($profile_perc > 99) echo 'webkit-border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px;'; ?>"></div>
                </div>
            </div>
            
            <div class="mid-option">
            	<div id="icon-top10" class="mid-icon"></div>
                <div class="mid-title">Top 10 Questions</div>
                <div id="answer-now-top10" class="mid-button">Answer Now</div>
				<div class="option-percent"><?php echo $top10_perc."%"; ?> Complete</div>
                <div class="option-loadwrap">
					<div class="option-loading" style="width: <?php echo $top10_perc; ?>%;<?php if($top10_perc > 99) echo 'webkit-border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px;'; ?>"></div>
                </div>
                <div class="mid-view">View Similar Answered Questions</div>
            </div>
            
            <div class="mid-option">
            	<div id="icon-top100" class="mid-icon"></div>
                <div class="mid-title">Top 100 Questions</div>
                <div id="answer-now-top100" class="mid-button">Answer Now</div>
				<div class="option-percent"><?php echo $top100_perc."%"; ?> Complete</div>
                <div class="option-loadwrap">
					<div class="option-loading" style="width: <?php echo $top100_perc; ?>%; <?php if($top100_perc > 99) echo 'webkit-border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px;'; ?>"></div>
                </div>
                <div class="mid-view">View Similar Answered Questions</div>
            </div>
            
            <div class="mid-option">
            	<div id="icon-skipped" class="mid-icon"></div>
                <div class="mid-title">Top Skipped</div>
                <div id="answer-now-skipped" class="mid-button">Answer Now</div>
                <div class="option-percent">75% Complete</div>
                <div class="option-loadwrap">
                	<div class="option-loading" style="width: 75%; <?php if($total_perc > 99) echo 'webkit-border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px;'; ?>"></div>
                </div>
                <div class="mid-view">View Similar Answered Questions</div>
            </div>
        
        </div><!--mid-container-->
        
        <div id="h-loadwrap" style="margin-bottom: 10px;" >
		<div id="h-loadbar" style="width: <?php echo $total_perc; ?>%; "></div>
        </div>
        
        <div class="mid-container mid-bottom">
        	<div class="pts-left">
            	<span class="ab20-black">POINTS:</span>
				<span class="ab20-blue"><?php echo $points; ?></span>
                <br/>
				<a href="addquestion.php">
				<span class="a12-black-under">You can Create <?php echo (int)($points / 50 - $questions_created); ?> Questions</span>
				</a>
                <br/>
                <span class="ab12-black"><a class="a12-black-under" href="group.php">Create your own group</a></span>
            </div>
            
            <div class="pts-right">
            	<span class="a15-black">Questions Answered: </span>
				<span class="ab15-blue"><?php echo $total_a; ?></span>
                <br/>
            	<span class="a15-black">Questions Asked: </span>
				<span class="ab15-blue"><?php echo $questions_created; ?></span>
                <br/>
            </div>
        </div><!--mid-container-->
        
    </div>
    </div>
</div>

<?php
	include_once('php/html.php');
	HTML::show_background();
	HTML::show_footer();
?>

</body>
</html>
