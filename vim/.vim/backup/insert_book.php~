<html>
<head>
	<title>Book-O-Rama Book Entry Results</title>
</head>

<body>
	<h1>Book-O-Rama Book Entry Results</h1>
	<?php
phpinfo();
		// create short variable names
		$isbn = $_POST['isbn'];
		$author = $_POST['author'];
		$title = $_POST['title'];
		$price = $_POST['price'];

		if (!$isbn || !$author || !$title || !$price) {
			echo 'You have not entered all required details. Please go back and try again.';
			exit;
		}

		if (!get_magic_quotes_gpc()) {
			$isbn = addslashes($isbn);
			$author = addslashes($author);
			$title = addslashes($title);
			$price = doubleval($price);
		}

		@ $db = new mysqli('localhost', 'bookorama', 'bookorama123', 'books');

		if (mysqli_connect_errno()) {
			echo 'Error: Could not connect to database. Please try again later.';
			exit;
		}
		
		/**
		 * The following code is same as the one below it:
		 *************************************************
		$query = "insert into books values(?, ?, ?, ?)";
		$stmt = $db->prepare($query);
		$stmt->bind_param("sssd", $isbn, $author, $title, $price);
		$stmt->execute();
		echo $db->affected_rows." book inserted into database.";
		$stmt->close();
		*/

		$query = "insert into books values
				  ('".$isbn."', '".$author."', '".$title."', '".$price."')";
		$result = $db->query($query);

		if ($result) {
			echo $db->affected_rows." book inserted into database.";
		} else {
			echo "An error has occured. The item was not added.";
		}

		$db->close();
	?>
</body>
</html>
