$(document).ready(function() {
	$("#prof-left").click(function() {
		toggle_statistic();
		return false;
	});

	$(".statistic-x").click(function() {
		toggle_statistic();
		return false;
	});

	function toggle_statistic()
	{
		// the popup to toggle
		var popup = $("#statistic-popup");

		if (!popup.is(":visible")) {
			// put it in the bottom middle
			var x = ($(window).width() - 537) / 2;
			popup.css("left", x+"px");
			popup.css("bottom", "40%");

			// set question to the current question
			var question = $("#question-string").text();
			$(".statistic-question").text(question);
			// set answers to the current answers
			$("#answer-string-1").text($("#main-qrows-1").text()+" -");
			$("#answer-string-2").text($("#main-qrows-2").text()+" -");
			$("#answer-string-3").text($("#main-qrows-3").text()+" -");
			$("#answer-string-4").text($("#main-qrows-4").text()+" -");

			// get the GET variables
			var category = get_url_vars()["category"];
			if (category == null)
				category = "profile";
			// make an ajax call to get the numbers from db
			$.post("../php/statistic.php", { "category": category, "qid": $('#prev_question_id').val() },
				function(values) {
					// when the call is complete, copy the results into the popup...
					$("#answer-percent-1").text(values.answer1_percent+"% Answered");
					$("#answer-percent-2").text(values.answer2_percent+"% Answered");
					$("#answer-percent-3").text(values.answer3_percent+"% Answered");
					$("#answer-percent-4").text(values.answer4_percent+"% Answered");
					// ... set the graph bars proper height
					var init_percent = 89 / 100;
					$("#graph-bar-1").css("height", (init_percent * values.answer1_percent)+"px");
					$("#graph-bar-2").css("height", (init_percent * values.answer2_percent)+"px");
					$("#graph-bar-3").css("height", (init_percent * values.answer3_percent)+"px");
					$("#graph-bar-4").css("height", (init_percent * values.answer4_percent)+"px");
					// ... and fade it in
					popup.fadeIn();
				},
			"json");
		} else
			popup.fadeOut();
	}

	// function for retrieving GET variables from URL
	function get_url_vars()
	{
		var map = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
			map[key] = value;
		});
		return map;
	}
});
