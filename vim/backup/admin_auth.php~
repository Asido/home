<?php

require_once('database.php');
require_once('config.php');

$admin_auth = new admin_auth();

class admin_auth
{
	var $db;

	public function admin_auth()
	{
		$this->db = database::get_instance();
	}


	public function login($username, $password, $encrypt_password = true)
	{
		$db = $this->db;

		$db->format_string($username);
		$db->format_string($password);

		if (!$username || !$password) {
			echo "Bad input provided";
			exit;
		}

		if ($encrypt_password)
			$password = sha1($password);

		if (!$db) {
			echo "Connection to the database failed";
			exit;
		}
		$query = "SELECT *
				  FROM admin_users
				  WHERE username = '".$username."'
				  AND password = '".$password."'";
		$result = $db->query($query);
		if (mysql_num_rows($result) == 0) {
			$this->logout();
			return false;
			if
		}

		if (!isset($_SESSION))
			session_start();
		$_SESSION['admin_username'] = $username;

		return true;
	}

	public function logged_in()
	{
		if (!isset($_SESSION))
			session_start();

		if (!isset($_SESSION['admin_username']))
			return false;
		return true;
	}

	public function logout()
	{
		if (!isset($_SESSION))
			session_start();
		session_destroy();
	}
}

?>
