<?php
session_start();
require_once('php/auth.php');
//if (!$auth->logged_in() && !$auth->cookie_login())
	//header("Location: login.php");

$user = $auth->get_user();

if (isset($_POST['zip']) && $user['zip'] != $_POST['zip']) {
	$auth->change_info("zip", $_POST['zip']);
	$changed = true;
}
if (isset($_POST['paypal']) && $user['paypal'] != $_POST['paypal']) {
	$auth->change_info("paypal", $_POST['paypal']);
	$changed = true;
}
if (isset($_POST['psw']) && $user['password'] != $_POST['psw']) {
	$auth->change_info("password", sha1($_POST['psw']));
	$changed = true;
}
if (isset($_POST['email']) && $user['email'] != $_POST['email']) {
	$auth->change_info("email", sha1($_POST['email']));
	header("Location: login.php");
}

if (isset($changed))
	$user = $auth->get_user();
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="js/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
<script type="text/javascript" src="js/avatar_upload.js"></script>
<script type="text/javascript">
 function clickFileUpload() {
          $('input[type=file]:first').trigger('click');
        }
function edit_validate()
{$('#email').css('border','thin solid');
$('#zip').css('border','thin solid');
$('#paypal').css('border','thin solid');
$('#password').css('border','thin solid');
$('#password1').css('border','thin solid');
pswd=$('#password').val();
	if($('#email').val()=="")
	{
	
		$('#edit_err').html("Please enter a E-mail");
		$('#email').css('border','#F00 thin solid');
		return false;
	}
	if($('#email').val()!="")
	{
		email = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
		email1=$('#email').val();
		if(email.test(email1)==false)
		{
			$('#edit_err').html("Please enter a valid E-mail");
				$('#email').css('border','#F00 thin solid');
	
			return false;
		}
	}
		if($('#zip').val()=="")
	{
		$('#edit_err').html("Please enter a zip code");
		$('#zip').css('border','#F00 thin solid');
		return false;
	}
	if($('#paypal').val()=="")
	{
	
		$('#edit_err').html("Please enter paypal");
		$('#paypal').css('border','#F00 thin solid');

		return false;
	}
	if($('#password').val()=="")
	{
		$('#edit_err').html("Please enter a password");
		$('#password').css('border','#F00 thin solid');
		return false;
	}
	if(pswd.length<6)
	{
		$('#edit_err').html("Password must contain 6 letters");
		$('#password').css('border','#F00 thin solid');

			return false;
	}
	if($('#password1').val()=="")
	{
		$('#edit_err').html("Please enter a password");
		$('#password1').css('border','#F00 thin solid');


		return false;
	}
	if($('#password').val()!=$('#password1').val())
	{
		$('#edit_err').html("Passwords do not match");
				$('#password').css('border','#F00 thin solid');
		$('#password1').css('border','#F00 thin solid');

		
			return false;
	}


}
</script>
</head>
	
<body>
<div class="content" >

	<?php 
	require_once('php/html.php');
	HTML::print_header();
	?>
    
    <div class="content_innerdash" style="height:495px">

		<?php HTML::print_dashboard(); ?>
    	
		<div class="das_inner">
			<div class="edit_pic">
			<form id="avatar-form" action="php/upload_avatar.php" method="post" class="asgmnt" enctype="multipart/form-data">
			
			<input type="file" style="width:0px; height:0px;"/><!-- to get file browser-->
				<div class="editpic"><div class="pic"><img <?php if ($user['avatar'] != "") echo 'src="avatars/'.$user['avatar'].'"'; ?>></img></div></div>
				<div class="change_pic" name="avatar-file" ><a href="#" onclick="clickFileUpload()" >Change Picture</a></div>
			  
				</form>
				
			</div>
			<div class="edit_right">
			<form method="post" action="edit_profile.php" class="asgmnt">
			
			<div class="edit"><div class="edit_email">E-mail </div><div class="dot">:</div><div class="edit_text"><input class="email" name="email" id="email" type="text" value="<?php echo $user['email']; ?>" /></div></div>
				<div class="edit"><div class="edit_email">Postal Code </div> <div class="dot">:</div><div class="edit_text"><input class="email" name="zip" id="zip" type="text" value="<?php echo $user['zip']; ?>" /></div></div>
				<div class="edit"><div class="edit_email">Paypal</div><div class="dot">:</div> <div class="edit_text"><input class="email" name="paypal" id="paypal" type="text" value="<?php echo $user['paypal']; ?>" /></div></div>
				<div class="edit"><div class="edit_email">Change Password </div><div class="dot">:</div><div class="edit_text"> <input class="email" name="psw" id="password" type="password" /></div></div>
				<div class="edit"><div class="edit_email">Re-type Password</div><div class="dot">:</div><div class="edit_text"> <input class="email" name="confirm_psw" id="password1" type="password" /></div></div>
				<div class="edit" style="height:20px"><div class="edit_err" id="edit_err"></div></div>
				<input type="submit" value="Submit" class="edit_submit" onclick="return edit_validate();"/>
			</form>
			</div>
			</div>
			
			
			</div>
    </div>
    
</body>
</html>
