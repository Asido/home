<?php

require_once('php/auth.php');
require_once('php/database.php');

// $logged = $auth->logged_in();
// 
// if (!$logged) {
// 	if (!$auth->cookie_login()) {
// 		header('Location: login.php');
// 		exit;
// 	}
// }

$db = database::get_instance();
$top_users = $db->query("SELECT `avatar_filename`,`questions_answered`,`questions_asked`,`username` FROM `users` WHERE `avatar_filename`<> '' ORDER BY `points` DESC LIMIT 12");
$top_groups = $db->query("SELECT `group_id`, COUNT(*) AS `count` FROM `groups_MTM_users` GROUP BY `group_id` ORDER BY `count` DESC LIMIT 8");

?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>LikemelikeU</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/styles.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery-1.4.2.js"></script>
<script type="text/javascript" src="js/search.js"></script>
<script type="text/javascript">
	function show_user_statistic(avatar, q_asked, q_answered, rank)
	{
		if (!$("#user-stat-popup").is(":visible")) {
			$(".popup-avatar img").attr("src", "avatars/"+avatar);
			$(".popup-rank").html("Rank "+rank);
			$("#popup-q-asked .popup-count").html(q_asked);
			$("#popup-q-answered .popup-count").html(q_answered);
			$("#user-stat-popup").show();
		}
	}
	$(document).ready(function() {
		$(".user-avatar").mousemove(function(e) {
			$("#user-stat-popup").css("left", (e.pageX+30)+"px");
			$("#user-stat-popup").css("top", (e.pageY-200)+"px");
		});
	});
	function hide_user_statistic()
	{
		$("#user-stat-popup").hide();
	}
</script>
</head>

<body>

<?php
require_once('php/html.php');
HTML::show_header();
?>

<!-- user statistic popup -->
<div id="user-stat-popup">
	<div class="popup-avatar"><img></img></div>
	<span class="popup-rank">Rank 1</span>
	<div id="popup-q-asked">Questions Asked<span class="popup-count">28</span></div>
	<div id="popup-q-answered">Questions Answered<span class="popup-count">423</span></div>
</div>
<!-- end of user statistic popup -->

<div id="container-admin">
    <div class="si-main">
        <div class="si-submain">
            <table width="800" border="0" class="si-table1">
              <tr>
                <td width="250"><p style="margin-top:22px; margin-left:88px;">Question About :</p></td>
                <td width="400"><input type="text" name="search_input" id="search_input" class="si-textbx" style="margin-top:10px;"/></td>
                <td width="110">&nbsp;<div class="si-searchbtn"><p style="margin-top:8px; margin-left:15px; color:#FFF;" id="search_btn">SEARCH</p></div></td>
              </tr>
            </table>
			<div class="si-mainbelow" id="si-mainbelow">  
				<div id="questions" style="position:relative; padding: 5px 0 0 0;">
					<input type="hidden" id="h_page_nr" name="h_page_nr" value="1">
				</div>
				<div class="si-page"><span class="si-arrows" id="prev"> &laquo; </span>&nbsp;&nbsp;<span class="si-arrows" id="next"> &raquo; </span></div>
			</div>    
    
        </div>
        
        <div class="mid-container mid-small-padding">
        	<span class="ab16-black">FRIENDS:</span>
            <div class="results-container">
				<?php
				for ($i = 0; $i < 12; $i++) {
					$user = mysql_fetch_array($top_users);
					echo '<div class="friend-result">
						<div class="result-img"><img onMouseout="hide_user_statistic()" onMouseover="show_user_statistic(\''.$user['avatar_filename'].'\','.$user['questions_asked'].','.$user['questions_answered'].','.($i+1).')" class="avatar-img user-avatar" '.($user['avatar_filename'] != "" ? 'src="avatars/'.$user['avatar_filename'].'"' : '').' /></div>
							<div class="result-txt">
								<span class="ab11-gray">Name</span>
							</div><!--result-txt-->
						</div><!--friend-result-->';
				}
				?>
            </div><!--results-container-->
            <br/>
            
            <span class="ab16-black">GROUPS:</span>
            <div class="results-container">
				<?php

				for ($i = 0; $i < 8; $i++) {
					$sql = @mysql_fetch_array($db->query("SELECT `avatar`,`name` FROM `groups` WHERE `id`=".mysql_fetch_object($top_groups)->group_id));
					echo '
						<div class="group-result">
							<div class="result-img"><img class="avatar-img" '.($sql['avatar'] != "" ? 'src="tmp/'.$sql['avatar'].'"' : '').' /></div>
							<br/>
							<span class="a10-gray">'.$sql['name'].'</span>
						</div>
					';
				}
				?>
            
            </div>
        	
        
        </div><!--mid-container-->
        
        <div class="mid-container">
        	<div class="pts-left">
            	<span class="ab20-black">POINTS:</span>
                <span class="ab20-blue">166</span>
                <br/>
                <span class="a12-black-under">You can Create 3 Questions</span>
                <br/>
                <span class="ab12-black">FRIENDS/GROUP</span>
            </div>
            
            <div class="pts-right">
            	<span class="a15-black">Questions Answered: </span>
                <span class="ab15-blue">33</span>
                <br/>
            	<span class="a15-black">Questions Asked: </span>
                <span class="ab15-blue">33</span>
                <br/>
                <span class="a15-black">Friends: </span>
                <span class="ab15-blue">33</span>
                <br/>
                <span class="a15-black">Awaiting Confirmation</span>
                <span class="ab15-blue">(1)</span>
                <br/>
                <div class="bottom-button">View Summary and Statistics</div>
            </div>
        </div><!--mid-container-->
        
        <div id="h-loadwrap" class="mid-bottom">
        	<div id="h-loadbar" style="width: 33%"></div>
        </div>
        
    </div>
    </div>
</div>

<?php
	include_once('php/html.php');
	HTML::show_background();
	HTML::show_footer();
?>

</body>
</html>
