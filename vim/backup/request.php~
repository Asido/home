<?php
//include controller
include(CONDIR.DS."request.php");
include(INCDIR.DS."class.php");
$class = new sax;

$product=$class->F($class->where(TB_PRODUCT,"id",$QST2));

if(isset($_POST['SubmitRequest']))
{
	$str="INSERT INTO ".TB_REQUEST." SET fullname='".$_POST['fullname']."',emailaddress='".$_POST['emailaddress']."',subject='".$_POST['subject']."',";
	$str.="comments='".$_POST['comments']."',productid='".$QST2."',option1='".$_POST['option1']."',option2='".$_POST['option2']."',";
	$str.="option3='".$_POST['option3']."',postdate='".date("Y-m-d")."'";
	$exe=$class->Q($str);	
	$from=$_POST['emailaddress'];
	$to=$db['default']['admin_email'];
	$name=$_POST['fullname'];
	$sub=$_POST['subject'];
	$des=$_POST['comments'];
	$opt1=$_POST['option1'];
	$opt2=$_POST['option2'];
	$opt3=$_POST['option3'];
	$comm=$name." Sent a Product Request.<br>";
	$comm.="Product Informations are given below.<br><br>";
	$comm.="Product Name: ".$product['productname']."<br>";
	$comm.="Item : ".$product['id']."<br>";
	$comm.="List Price : $".$product['listprice']."<br>";
	$comm.="Your Price : $".$product['cost']."<br>";
	$comm.="<br><b>Options:</b><br><br>";
	$comm.="Option1 : ".$opt1."<br>";
	$comm.="Option2 : ".$opt2."<br>";
	$comm.="Option3 : ".$opt3."<br><br>";
	$comm.="<b>User Information:</b><br><br>";
	$comm.="Full Name : ".$name."<br>";
	$comm.="Email Address : ".$from."<br>";
	$comm.="<b>User Comments:</b><br>";
	$comm.=$des;	
	
	$send=$class->sentmail($to,$sub,$from,$comm);
	if($send)
	echo $class->R(SITELINK."request/".$QST2."/succ/Send Product Request!");
	else
	echo $class->R(SITELINK."request/".$QST2."/err/Send Product Request!");
}
?>
<div class="content_areaInRight">
          
          <!-- Begin contentBoxArea -->
          <div class="contentBoxArea">
            <!-- Begin contentBoxAreaLeft -->
            <div class="contentBoxAreaLeft">
              <div style="width:655px;"><span class="title">Product Request</span>
                <form action="" method="post" name="fomr1" onsubmit="return refervalid();">
                <table width="100%" border="0" align="center">
                  <tr>
                    <td width="6" align="left" valign="middle">&nbsp;
                    <?php 
					
					if($QST3=="err"){echo "<span class='red'>Error, while sending mail, please try again.</span>";}
					?>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="middle"><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="border:1px solid #F7D1B1;">
                      <tr>
                        <td align="left" valign="middle" class="font3" style="padding-left:15px;">&nbsp;</td>
                      </tr>
                      <tr>
                        <td height="35" align="center" valign="middle" class="font3">
                        <?php
                        if($QST3=="succ"){echo "<span class='green'>Thank you for Sent a Request and we will contact you soon.</span>";}
						else{
						?>
                        <table width="98%" border="0" align="center" cellpadding="0" cellspacing="2" style="border:1px solid #D8D8D8;">
                      <tr>
                        <td height="30" colspan="3" align="left" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-left:10px;">
						<span class="font2"><?php echo $product['productname']?></span></td>
                      </tr>
                      <tr>
                        <td height="30" colspan="3" align="left" valign="middle">
                        <table width="100%" border="0" align="center" cellpadding="0" cellspacing="2">
                          <tr>
                            <td width="29%" rowspan="4" align="center" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:5px;">
                            <?php
								if($product['image1']!="" && $product['image1']!="prodimageslg/")
								{
									$imgspt=explode("prodimageslg/",$product['image1']);
									$imgg=SITEPRO."".$imgspt[1];
									$imggp="Sax/property/".$imgspt[1];
								}
								else
								{
								$imgg=SITEIMG."noimg.jpg";
								$imggp="images/noimg.jpg";
								}
								list($width, $height, $type, $attr) = getimagesize($imggp);
								 if($width<="235")
								 $wdth=$width;
								 else
								 $wdth="235";
								 if($height<="150")
								 $hgt=$height;
								 else
								 $hgt="150";
								?>
								<img src="<?php echo $imgg; ?>" alt="" width="<?php echo $wdth;?>" height="<?php echo $hgt;?>" />
                            </td>
                            <td height="30" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:5px;">
                            <span class="font2">Item#:</span></td>
                            <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;"><?php echo $product['id']?></td>
                          </tr>
                          <tr>
                            <td width="21%" height="30" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:5px;">
                            <span class="font2">List Price:</span></td>
                            <td width="50%" align="left" valign="middle" bgcolor="#F1F1F1" class="offerprice"  style="padding-left:5px;">
                              $<?php echo number_format($product['listprice']);?></td>
                          </tr>
                          <tr>
                            <td height="30" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:5px;">
                            <span class="font2">Your Price:</span></td>
                            <td align="left" valign="middle" bgcolor="#F1F1F1" class="font3"  style="padding-left:5px;">
                              $<?php echo number_format($product['cost']);?></td>
                          </tr>
                          <tr>
                            <td height="30" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:5px;">
                            <span class="font2">Availability:</span></td>
                            <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
                              <span class="font2" style="font-size:10px;">
                                <span class="green"><?php if($product['availability']=="1"){echo "In Stock";}?></span>
                                <span class="red"><?php if($product['availability']=="0"){echo "Out of Stock";}?></span>
                              </span></td>
                          </tr>
                        </table></td>
                      </tr>
                      <tr>
                        <td height="30" colspan="3" align="left" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-left:10px;">
                        <span class="font2">Options</span></td>
                      </tr>
                      <?php if($product['option1']!="")
						{
							$spt=explode(":",$product['option1']);
							$valopt1=explode(",",$spt[1]);
							$tot=count($valopt1);
							?>
                      <tr>
                        <td width="12" height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;">
                        <span class="font2"><?php echo $spt[0];?></span></td>
                        <td width="61%" align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
						<select name="option1" id="option1" class="txtborder" style="width:100px;">
						  <?php for($i=0;$i<$tot;$i++)
                          {?>
                          <option value="<?php echo $valopt1[$i]?>"><?php echo $valopt1[$i]?></option>
                          <?php }?>
                          </select>
                        </td>
                      </tr>
                      <?php }?>
                      <?php if($product['option2']!="")
					  	 {
						  $spt=explode(":",$product['option2']);
						  $valopt2=explode(",",$spt[1]);
						  $tot=count($valopt2);
						  ?>  
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;">
                          <span class="font2"><?php echo $spt[0];?></span></td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
                        <?php if($product['option2']!="")
					  	 {
						?>
                        <select name="option2" id="option2" class="txtborder" style="width:100px;">
						<?php for($i=0;$i<$tot;$i++)
                        {?>
                        <option value="<?php echo $valopt2[$i]?>"><?php echo $valopt2[$i]?></option>
                        <?php }?>
                        </select>
                        <?php }?>
                        </td>
                      </tr> <?php }?>
                      <?php if($product['option3']!="")
					  {
						$spt=explode(":",$product['option3']);
						$valopt3=explode(",",$spt[1]);
						$tot=count($valopt3);
					  ?>
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;">
                        <span class="font2"><?php echo $spt[0];?></span></td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
						<select name="option3" id="option3" class="txtborder" style="width:100px;">
						  <?php for($i=0;$i<$tot;$i++)
                          {?>
                          <option value="<?php echo $valopt3[$i]?>"><?php echo $valopt3[$i]?></option>
                          <?php }?>
                          </select>
                        </td>
                      </tr>
                      <?php }?>
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;">
                        <span class="font2">Your Name</span></td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
                          <input type="text" name="fullname" id="fullname" class="txtborder" style="width:200px;" />
                        </td>
                      </tr>
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;"><span class="font2">Your Email</span></td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
                        <input type="text" name="emailaddress" id="emailaddress" class="txtborder" style="width:200px;"/>
                        </td>
                      </tr>
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;"><span class="font2">Subject</span></td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
                        <input type="text" name="subject" id="subject" class="txtborder" style="width:200px;"/>
                        </td>
                      </tr>
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;"><span class="font2">Comments</span></td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;">
                        <textarea name="comments" class="txtborder" id="comments" style="width:300px; height:100px;"></textarea>
                        </td>
                      </tr>
                      <tr>
                        <td height="40" align="right" valign="middle" bgcolor="#D8D8D8" class="font3" style="padding-right:8px;">&nbsp;</td>
                        <td align="left" valign="middle" bgcolor="#F1F1F1" class="font2" style="padding-left:5px;"><span class="font3" style="padding-left:15px;">
                          <input type="submit" name="SubmitRequest" class="buttonbg" value="Send" />
                        </span></td>
                      </tr>                      
                    </table>
                    <?php }?>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" valign="middle" class="font3" style="padding-left:15px;">&nbsp;</td>
                      </tr>
                    </table></td>
                  </tr>
                  <tr>
                    <td align="left" valign="middle">&nbsp;</td>
                  </tr>
                </table>
                </form>
              </div>
            </div>
            <!-- End contentBoxAreaLeft -->
          </div>
          <!-- End contentBoxArea -->
        </div>
<script type="text/javascript" language="javascript">
function refervalid()
{
	if(document.getElementById('txtfromname').value=="")	
	{
		document.getElementById('txtfromname').style.borderColor="red";
		document.getElementById('txtfromname').focus();
		return false;
	}
	else
	{
		document.getElementById('txtfromname').style.borderColor="#006633";
	}
	
	if(document.getElementById('txtfromemail').value=="")	
	{
		document.getElementById('txtfromemail').style.borderColor="red";
		document.getElementById('txtfromemail').focus();
		return false;
	}
	else
	{
		document.getElementById('txtfromemail').style.borderColor="#006633";
	}
	
	if(document.getElementById('txtfromemail').value!="")
	{
		var x = document.getElementById('txtfromemail').value;
		var filter  = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
		if (filter.test(x))
		{
			 document.getElementById('txtfromemail').style.borderColor="#006633";
		}
		else 
		{
	 	 document.getElementById('txtfromemail').style.borderColor="red";
		 document.getElementById('txtfromemail').focus();
		 return false;
		}
	}	
	
	if(document.getElementById('txtfriends').value=="")	
	{
		document.getElementById('txtfriends').style.borderColor="red";
		document.getElementById('txtfriends').focus();
		return false;
	}
	else
	{
		document.getElementById('txtfriends').style.borderColor="#006633";
	}
	
	if(document.getElementById('txtsubject').value=="")	
	{
		document.getElementById('txtsubject').style.borderColor="red";
		document.getElementById('txtsubject').focus();
		return false;
	}
	else
	{
		document.getElementById('txtsubject').style.borderColor="#006633";
	}
	
	if(document.getElementById('txtcomments').value=="")	
	{
		document.getElementById('txtcomments').style.borderColor="red";
		document.getElementById('txtcomments').focus();
		return false;
	}
	else
	{
		document.getElementById('txtcomments').style.borderColor="#006633";
	}
}
</script>        
