$('document').ready(function() {
	$('#r4-left').click(function() {
		if (isInputOk("#login-form"))
			$('#login-form').submit();
	});

	$('#r4-page-left').click(function() {
		if (isInputOk("#login-page-form"))
			$('#login-page-form').submit();
	});

	$('#r4-admin-left').click(function() {
		if (isInputOk("#admin-login-form"))
			$('#admin-login-form').submit();
	});

	$('#row-rbutton').click(function() {
		if (isInputOk("#signup-form")) {
			$('#signup-form').submit();
		}
	});
	
	var csv_format = {
		'.csv' : 1,
	};
	var img_format = {
		'.png' : 1,
		'.jpeg': 2,
		'.jpg' : 3,
	};

	$("#ma-upload").click(function() {
		$("#avatar-file-browse").click();
	});
	$("#avatar-file-browse").change(function() {
		var data = { 
			username : $("#uname").val()
		};

		if (this.value == "")
			return false;

		if (file_format_ok(this.value, img_format)) {
			$("#my-account-form").ajaxSubmit({
				url: 'php/upload_avatar.php',
				dataType: 'json',
				type: 'POST',
				data: data,
				beforeSubmit: function() { },
				success: function(ret_val) { 
					// $.growlUI("Notification", ret_val.ret);
					// $("#ma-img").css("background-image", "url(avatars/"+ret_val.ret+")");
					$("#avatar-img").attr("src","avatars/"+ret_val.ret);
				},
				error: function(var1, var2, var3) { 
					alert(var1);
					alert(var2);
					alert(var3);
					// $.growlUI("ERROR", var3);
				}
			});
			return false;
		} else
			alert("png and jpeg formats supported only");
	});

	$("#cms-question-submit").click(function() {
		var inputs = $("#cms-question-form input[type=text]");
		if (inputs[0] != "") {// && inputs[1] != "" && inputs[2] != "" && inputs[3] != "" && inputs[4] != "") {
			$("#cms-question-form").ajaxSubmit({
				url: 'php/upload_ques.php',
				dataType: 'json',
				type: 'POST',
				beforeSubmit: function() { },
				success: function(ret_val) { 
					$.growlUI("Notification", ret_val.ret);
				},
				error: function(var1, var2, var3) { 
					$.growlUI(var2, var3);
				}
			});
		}
	});

	$("#user-cms-question-submit").click(function() {
		var inputs = $("#cms-question-form input[type=text]");
		if (inputs[0] != "") {// && inputs[1] != "" && inputs[2] != "" && inputs[3] != "" && inputs[4] != "") {
			$("#cms-question-form").ajaxSubmit({
				url: 'php/add_group_question.php',
				dataType: 'json',
				type: 'POST',
				beforeSubmit: function() { },
				success: function(ret_val) { 
					$.growlUI("Congratulations!", ret_val.ret);
				},
				error: function(var1, var2, var3) { 
					$.growlUI(var2, var3);
				}
			});
		}
	});

	$("#cms-file-button").click(function() {
		$('#cms-file-browse').trigger('click');
	});


	$("#cms-file-browse").change(function() {
		var data = { 
			category : $("#cms-select").val()
		};

		if (this.value == "")
			return false;

		if (file_format_ok(this.value, csv_format)) {
			$("#cms-file-form").ajaxSubmit({
				url: 'php/upload_ques.php',
				dataType: 'json',
				type: 'POST',
				data: data,
				beforeSubmit: function() { },
				success: function(ret_val) { 
					$.growlUI("Notification", ret_val.ret);
				},
				error: function(var1, var2, var3) { 
					$.growlUI(var2, var3);
				}
			});
			return false;
		} else
			alert("csv excel format supported only");
	});


	/* GROUP AVATAR UPLOAD */
	$("#group-upload").click(function() {
		$("#group-avatar-browse").trigger("click");
	});
	$("#group-avatar-browse").change(function() {
		if (this.value == "")
			return false;

		if (file_format_ok(this.value, img_format)) {
			$("#group-avatar-form").ajaxSubmit({
				url: 'php/upload_group_avatar.php',
				dataType: 'json',
				type: 'POST',
				beforeSubmit: function() { },
				success: function(ret_val) { 
					$("#group-img img").attr("src","tmp/"+ret_val.ret);
				},
				error: function(var1, var2, var3) { 
					alert(var1);
					alert(var2);
					alert(var3);
				}
			});
			return false;
		} else
			alert("png and jpeg formats supported only");
	});
	

	function file_format_ok(val, format)
	{
		var re = /\..+$/;
		var ext = val.match(re);
		if (format[ext])
			return true;
		else
			return false;
	}

	$("#group-create").click(function() {
			if ($("#group-name").val() == "") {
				alert("Group name has to be specified");
				return false;
			}
			var data = { 
				avatar : $("#group-img img").attr("src")
			};

			$("#group-form").ajaxSubmit({
				url: 'php/create_group.php',
				dataType: 'json',
				data: data,
				type: 'POST',
				beforeSubmit: function() { },
				success: function(ret_val) { 
					$.growlUI("Notification", ret_val.ret);
				},
				error: function(var1, var2, var3) { 
					alert(var1);
					alert(var2);
					alert(var3);
				}
			});
			return false;
	});

	// admin-dash setting change password form
	$("#update-button").click(function() {
		$("#password-change-form").ajaxSubmit({
			url: 'admin/content-5.php',
			dataType: 'json',
			type: 'POST',
			beforeSubmit: function() { },
			success: function(ret_val) { 
				$.growlUI("Notification", ret_val.msg);
			},
			error: function(var1, var2, var3) { 
				$.growlUI(var2, var3);
		   }
		});
	});
});
