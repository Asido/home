<?php
/**
 * @copyright 68 Classifieds
 *
 * @author 68 Designs, LLC
 * @version $Revision: 133 $
 * @package 68Classifieds
 * @link http://www.68classifieds.com
 *
 * @Updated: $Date: 2008-12-01 14:20:23 -0500 (Mon, 01 Dec 2008) $
 */
@ session_start();
require_once ('includes/init.php');
$class_tpl->caching = false;
$Gateway = Library::loadLibrary('Gateways', $db);
$Orders = Library::loadLibrary('Orders');
$Users = Library::loadLibrary('Users');
$Login = new Login($db);

if (empty($_SESSION['logged']))
{
	$Login->_logout();
}
if (isset($_SESSION['uid']))
{
	$userid = (int) $_SESSION['uid'];
}
if (isset($_SESSION['userlevel']))
{
	$userlevel = (int) $_SESSION['userlevel'];
}
unset($_SESSION['orderid']);

if (isset($_REQUEST['gateway']) && $_REQUEST['gateway'] != "" || isset($_REQUEST['crypt']))
{	
	$gateway = $_REQUEST['gateway'];
	if (isset($_REQUEST['crypt']))
	{
		$gateway = 'protex';
	}
	$params = $_POST;
	$callback = $Gateway->callBack($gateway, $params);
	if (!is_string($callback))
	{
		// if creating add, move to facebook check
		if ($_REQUEST['gateway'] == 'check') {
			// $_SESSION['listingid'] = $_POST['listingid'];
			// header("Location: thanks_fb.php");
			// exit;
		}
		$class_tpl->assign('message', LANG_THANK_YOU_MSG);
		$class_tpl->assign('body', 'checkout/thanks.tpl');
	}
	else
	{
		//error
		$class_tpl->assign('message', $callback);
		$class_tpl->assign('body', 'checkout/error.tpl');
	}
}
else
{
	//error
	$class_tpl->assign('body', 'checkout/error.tpl');
}
$class_tpl->display('layout.tpl');

/* End of file thanks.php */
/* Location: ./upload/thanks.php */
