#include <fcntl.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <stdlib.h>
#include "../../../source/lib/tlpi_hdr.h"

int main(int argc, char* argv[])
{
	if (argc < 3 || argc > 4 || strcmp(argv[1], "--help") == 0)
		usageErr("%s filename num_bytes [append_flag]", argv[0]);

	int fd;
	size_t buff_size = atoi(argv[2]);
	printf("writing %d bytes\n", buff_size);
	char buff[buff_size];

	int i;
	for (i = 0; i < buff_size-1; ++i)
		buff[i] = i % buff_size;
	/* buff[buff_size-1] = '\0'; */
	if (argc == 4)
		fd = open(argv[1], O_CREAT | O_WRONLY | O_APPEND, S_IRWXU);
	else
		fd = open(argv[1], O_CREAT | O_RDWR, S_IRWXU);
	lseek(fd, 0, SEEK_END);
	write(fd, buff, buff_size);
	close(fd);
	exit(EXIT_SUCCESS);
}
