<?php session_start();
//start session

//set directoryseparator
if (!DS) define('DS', DIRECTORY_SEPARATOR);
//if (!DS) define('DS', "/");
//echo $_SERVER['REQUEST_URI'];
//set path of current directory
if (!WEBDIR) define("WEBDIR",dirname(__FILE__));

//set path of include current directory
if (!INCDIR) define("INCDIR",WEBDIR.DS."inc");

//set path of view directory
if (!VIEWDIR) define("VIEWDIR",WEBDIR.DS."view");

//set path of view directory
if (!ADMINDIR) define("ADMINDIR",WEBDIR.DS."Sax");

//set path of controller directory
if (!CONDIR) define("CONDIR",WEBDIR.DS."control");
?>

<?php 

require_once(ADMINDIR.'/include/config.php');

//include configuration file
include(INCDIR.DS."config.php");

//include all functions
include(INCDIR.DS."functions.php");

//mysql persistant connect
$blog_dbcon = mysql_pconnect(HOSTNAME, USERNAME, PASSWORD) or trigger_error(mysql_error(),E_USER_ERROR);

//mysql select database
mysql_select_db(DATABASE,$blog_dbcon);

//include all common db action
include(CONDIR.DS."common.php");

//prepare url variables

if ( @strlen( $_SERVER['REQUEST_URI'] ) <= 1 ) {
$serverpaths = $_SERVER['PHP_SELF'] . '?' . $_SERVER['QUERY_STRING'];
}
else $serverpaths = "/index.php".$_SERVER['REQUEST_URI'];


//echo $serverpaths;
//exit;
$GET_URL = @explode("/",$serverpaths);

//accounting for "index.php" in uri segment 1 or 2 - Will
if ( $GET_URL[1]=="index.php" && $GET_URL[2]=="index.php" ) { 

$QST1 = @$GET_URL[3];
$QST2 = @$GET_URL[4];
$QST3 = @$GET_URL[5];
if(@$GET_URL[6]!="")
{
$QST4 = @$GET_URL[6];
}
if(@$GET_URL[7]!="")
{
$QST5 = @$GET_URL[7];
}

}

// all other urls here - Will
else {
	
$QST1 = @$GET_URL[2];
$QST2 = @$GET_URL[3];
$QST3 = @$GET_URL[4];
if(@$GET_URL[5]!="")
{
$QST4 = @$GET_URL[5];
}
if(@$GET_URL[6]!="")
{
$QST5 = @$GET_URL[6];
}

}

// For Server
//$QST1 = $GET_URL[1];
//$QST2 = $GET_URL[2];
//$QST3 = $GET_URL[3];
//if($GET_URL[4]!="")
//$QST4 = $GET_URL[4];
//if($GET_URL[5]!="")
//$QST5 = $GET_URL[5];
//echo $HTTP_SERVER_VARS['PATH_INFO'];
//echo $QST1." - ".$QST2." - ".$QST3." - ".$QST4;
//}
ob_start();

//set previous URL
if(@$_SESSION['PRVURL']!="")
{

$PRV_PATH = @explode("/",$_SESSION['PRVURL']);
	if($PRV_PATH[1]!="")
	{
	$PRV_PAGE = $PRV_PATH[1];
	}
$PRV_URL = SITELINK.substr($_SESSION['PRVURL'],1);
$PREF=@explode("/",$_SERVER['HTTP_REFERER']);
	if(@$PREF[4]!="")
	{
	$PREFLINK=$PREF[4];
	}
}
//include all common actions
include(INCDIR.DS."commonactions.php");

//routes configuration
if( $QST1=="" ) { include(VIEWDIR.DS."home.php"); }

if( $QST1!="" && $QST1!="admin" && $QST1!="faqs" && $QST1!="seo" ) {
	$view = VIEWDIR.DS.$QST1.".php";
	if( file_exists($view) ) include($view); else echo '<h1>Sorry for the inconvenience</h1><p>The page corresponding to current URL is not found.</p>';
}

if( $QST1!="" && $QST1=="admin" ) {
	if(!checkaccess('admin')) { header("Location:".SITEROOT); exit(); }
	$view = VIEWDIR.DS."admin".DS.$QST2.".php";
	if( file_exists($view) ) include($view); else echo '<h1>Sorry for inconvenience</h1><p>The page corresponding to current URL is not found.</p>';
}

if( $QST1!="" && $QST1=="faqs" ) {
	$view = VIEWDIR.DS."faqs".DS.$QST2.".php";
	$faqhome = VIEWDIR.DS.$QST1.".php";
	if( file_exists($view) ) include($view); else include($faqhome);
}

if( $QST1!="" && $QST1=="seo" ) {
	$view = VIEWDIR.DS."seo".DS.$QST2.".php";
	$seohome = VIEWDIR.DS.$QST1.".php";
	if( file_exists($view) ) include($view); else include($seohome);
}

?>
